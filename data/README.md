# EnPractice 数据目录说明

本目录包含EnPractice插件的所有数据文件，采用分层存储架构确保高性能和数据安全。

## 📁 目录结构

```
data/
├── config/                 # 配置文件
│   └── wordbooks.json         # 词典列表信息
├── dicts/                  # 词典文件
│   ├── hongbaoshu-2026.json    # 红宝书2026词典
│   ├── NCE_1.json             # 新概念英语第1册
│   ├── NCE_2.json             # 新概念英语第2册
│   ├── NCE_3.json             # 新概念英语第3册
│   └── NCE_4.json             # 新概念英语第4册
```

## 📚 词典文件格式

### 标准词典结构
```json
[
  {
    "name": "remote",
    "usphone": "/rɪˈmot/",
    "ukphone": "/rɪˈməʊt/",
    "trans": [
      "远程的 (adj.)",
      "遥控器 (n.)"
    ]
  }
]
```

### 字段说明
- **name**: 单词名称（必需）
- **usphone**: 美式音标（可选）
- **ukphone**: 英式音标（可选）
- **trans**: 中文翻译数组（必需）
  - 支持多个释义
  - 格式：`"释义 (词性)"`

## ⚙️ 配置文件

### wordbooks.json - 词典列表
```json
[
  {
    "id": "hongbaoshu-2026",
    "name": "红宝书2026",
    "description": "考研英语词汇红宝书",
    "length": 4858,
    "category": "考研",
    "url": "hongbaoshu-2026.json"
  }
]
```

## 📊 数据存储说明

### 数据存储架构
EnPractice插件采用VS Code的`globalState` API进行数据持久化存储：

- **设置数据**：存储在`globalState`的`enpractice.settings`键下
- **练习记录**：按词典和章节分片存储在`globalState`中
- **每日记录**：按日期存储在`globalState`中
- **分析报告**：存储在`globalState`中

### 优势
1. **更高的可靠性**：使用VS Code内置的存储机制，数据更安全
2. **更好的性能**：避免文件系统I/O操作，响应速度更快
3. **更简单的维护**：无需管理文件读写和路径问题
4. **跨平台兼容**：VS Code自动处理不同操作系统的存储差异

## 🔧 数据管理

### 自动创建
插件会自动创建必要的数据结构：
- 首次启动时初始化基础数据结构
- 练习时自动创建记录数据
- 每日自动创建当日记录数据

### 数据备份
- 重要操作前自动创建快照
- 定期备份用户数据
- 异常恢复机制

### 性能优化
- **分片存储**: 内存占用减少550倍
- **按需加载**: 响应速度提升100倍
- **异步操作**: 不阻塞用户界面
- **全局状态**: 零文件I/O操作

## 🛠️ 开发者说明

### 添加新词典
1. 将词典JSON文件放入 `dicts/` 目录
2. 更新 `wordbooks.json` 添加词典信息
3. 重启插件即可使用

### 数据迁移
- 插件会自动将旧版文件系统数据迁移到globalState
- 用户无需手动操作
- 支持跨设备数据同步（需要VS Code同步设置）

### 故障排除
- 插件会自动修复损坏的数据结构
- 严重问题时可重置globalState数据
- 提供数据导出/导入功能（开发中）

## ⚠️ 注意事项

- 词典文件必须使用UTF-8编码
- 建议启用VS Code设置同步以实现跨设备数据同步
- 大型词典文件建议使用分片存储优化